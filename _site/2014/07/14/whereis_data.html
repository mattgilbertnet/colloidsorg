<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <title>Why is it taking so long to post data? Data organization</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="/assets/style.css">

  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
<link rel="manifest" href="/assets/icons/site.webmanifest">
<link rel="mask-icon" href="/assets/icons/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/icons/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/icons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

  <script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
<script src="/assets/js/jquery.colorbox-min.js" type="text/javascript"></script>
<script src="/assets/js/slick.min.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function () {
  // Sticky Header
	createSticky($("#navheader"));


  // Image Gallery
  $('.gallery').colorbox({maxWidth:'100%', maxHeight:'100%', current: "Image {current} of {total}",
    rel:function() {        
        return $(this).data('rel');
    }
	});
	
	// VIdeo Gallery
  if($(window).width() > 700 && $(window).height() > 400){
		$('.videogallery').colorbox({iframe: true, innerWidth: 640, innerHeight: 390, current: "Video {current} of {total}",
			rel:function() {        
					return $(this).data('rel');
			}
		});
	} else {
	  $( "a.videogallery" ).each(function( index ) {
      console.log( "href: " + $( this ).attr('href') );
      console.log( "althref: " + $( this ).attr('data-althref') );
      $( this ).attr('href', $( this ).attr('data-althref'));
    });
	}
	
	
	// Slick Carousel of featured items on the front page
	$('.carousel').slick({
		dots: true,
		infinite: false,
		speed: 300,
		slidesToShow: 4,
		slidesToScroll: 4,
		responsive: [
			{
				breakpoint: 1024,
				settings: {
					slidesToShow: 3,
					slidesToScroll: 3,
					infinite: true,
					dots: true
				}
			},
			{
				breakpoint: 600,
				settings: {
					slidesToShow: 2,
					slidesToScroll: 2
				}
			},
			{
				breakpoint: 480,
				settings: {
					slidesToShow: 1,
					slidesToScroll: 1
				}
			}
			// You can unslick at a given breakpoint now by adding:
			// settings: "unslick"
			// instead of a settings object
		]
	});
	
});

function createSticky(sticky) {
	
	if (typeof sticky !== "undefined") {

		var	pos = sticky.offset().top,
				win = $(window);
			
		win.on("scroll", function() {
    		win.scrollTop() >= pos ? sticky.addClass("fixed") : sticky.removeClass("fixed");      
		});			
	}
}
</script>


  
</head>
<body><header class="container page-header">

  <div class="wrapper"><a class="site-title" rel="author" href="http://peterlu.org/"><img id="logo_header" src="/assets/images/logo_header.png" alt="Peter J. Lu"/></a>
  </div>
</header>

<div id="navheader">
	<div class="site-nav-row row">
		<div class="site-nav-container column">
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
        
						<div class="nav-home"><a href="http://peterlu.org/" alt="Peter J. Lu"><img id="nav_home_logo" src="/assets/images/logo_header_small.png" alt="Peter J. Lu"></a></div>
					<ul>
						<li id="nav-home-slick"><a href="/" alt="Home">Home</a></li>
					
						<li><a href="http://www.peterlu.org/research/" alt="Research">Research</a></li>
					
						<li><a href="http://www.peterlu.org/publications/" alt="Publications">Publications</a></li>
					
						<li><a href="http://www.peterlu.org/press/" alt="Press">Press</a></li>
					
						<li><a href="http://www.peterlu.org/photo/" alt="Photo">Photo</a></li>
					
						<li><a href="http://www.peterlu.org/video/" alt="Video">Video</a></li>
					
						<li><a href="http://www.peterlu.org/about.html" alt="About">About</a></li>
					
					</ul>
        </div>
      </nav>
		</div>
	</div>
</div><div class="container">

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article>
<h1 id="data-organization-cannot-be-defined-before-the-experiment-runs">Data organization cannot be defined before the experiment runs</h1>

<p>We have received hundreds of images from the first three runs, and the current fourth run, from ACE-M2 over the past few weeks. Yet I haven’t been posting very much in the way of analysis. Why? It’s not because I haven’t received or looked at the image, but because of another fundamental challenge: how the data is organized and presented to us (as the PIs) from NASA and ZIN, who are running the experiment.</p>

<h3 id="we-dont-know-ahead-of-time-what-data-we-will-take">We don’t know ahead of time what data we will take</h3>

<p>NASA typically has an engineering culture, where goals are specified, often with mind-numbing specificity, and criteria for progress and success defined. This is fine when the task to be accomplished can actually be defined ahead of time, as in the design, engineering, fabrication, launch and operation of a piece of equipment. But this mentality is a less convenient fit for scientific experiments, where the main objective is to learn something <em>newe</em> about a scientific phenomenon. This is especially true in our little corner of soft-matter physics, where we do experiments quickly, change things rapidly in response to what we see, then do another experiment—much like the “fail quickly” mentality of Silicon Valley startups.</p>

<h3 id="lots-and-lots-of-potential-data-we-could-collect">Lots and lots of potential data we could collect</h3>

<p>To that end, we launched a wide range of samples of different kinds of materials: dyes, suspensions of colloids in solvent, and colloid-polymer mixtures that undergo phase separation and gelation. The LMM microscope has several objective lenses (2.5x, 10x, 20x, 40x, 63x, 100x) and several modes of imaging (bright-field, fluorescence) and the fluorescence mode has several filters to excite and detect at different wavelengths. And within each sample, there are several different locations that we could image, and a variety of depths. So there are thousands upon thousands of possible choices we can make to collect an image from the sample.</p>

<p>This tremendous flexibility makes ACE a potentially powerful experiment, but at the cost of simplicity. With BCAT, we had a single view (fill the frame with the sample), and only one sample at a time—which takes several weeks to run. The data involves a single time series of a few hundred images, which get nicely zipped up and posted weekly by our extremely talented and hardworking point-woman at ZIN, Cathy Frey. Nonetheless, while the BCAT data is now easy to organize, it took several years and probably a dozen runs before we got our stride in what images to collect. With ACE, the problem is probably two orders of magnitude more complex!</p>

<h3 id="existing-data-structure-therefore-represents-a-best-guess-by-engineers-years-in-advance">Existing data structure therefore represents a best-guess by engineers years in advance</h3>

<p>At the moment, there is a relatively byzantine file-folder structure that places images from data sets in a tree labeled by a number of things, including date, experiment number, and objective lens. We didn’t know what samples we were going to launch until a few months before delivery, because we need always to keep the experiments as up-to-date as possible, to make sure we are using the most advanced sample preparation and to tie into the science that is actually interesting <em>now</em>. As convenient as it is for the bureacrats, specifying these things years in advance only guarantees that the results are not interesting to anyone.</p>

<p>By contrast, the instruments (e.g. the LMM) must undergo years of development and testing before launch, and simply cannot wait until we have samples ready, because of all of the constraints in engineering that operating on-board the ISS requires. So the engineers who build the hardware and design the software and protocols <em>cannot possibly know</em> what the actual experiments will be. This is the challenge of the long-latency structure of operating experiments in microgravity (and is absolutely not endemic to NASA; ESA has exactly the same issues, as do other agencies).</p>

<p>All of this is <strong>absolutely not a criticism</strong> of anyone or any part of the process. It’s just a big challenge that we must overcome to be successful in doing real, dynamic, new science onboard the ISS. Nevertheless, this leads to an important truth:</p>

<h2 id="the-organization-transmission-storage-and-curation-of-data-is-a-fundamental-part-of-doing-both-proper-engineering-and-actual-new-science-onboard-the-iss-which-is-almost-never-mentioned-and-people-never-really-think-about">The organization, transmission, storage and curation of data is a fundamental part of doing both proper engineering and actual new science onboard the ISS, which is almost never mentioned, and people never really think about.</h2>

<p>It’s basically assumed that, by some magical process, whatever data the PI wants will magically appear online, which they should hurry up and download, analyze, and get results back <em>this week</em> to send results back to everyone in the weekly science summary.</p>

<p>For any given week, I can tell you what the science summary is: we got data, and we are trying to figure out what we are looking at, and if it’s correct. Jumping to any more rapid conclusions—or, worse yet, trying to spread the message in public, to the press, or via social media—is courting cold-fusion disaster. Yes, the news cycles are quick, and people want an instant reaction or result spread immediately.</p>

<p><em>Unfortunately, the process of actually doing science is limited by human brainpower, and all evidence suggests that social media makes us if anything stupider. I certainly haven’t become faster at fundamental understanding due to the advent of social media, though others may be more talented.</em></p>

<p>Nonetheless, the process of understanding what is happening quickly improves with experience. We had a good idea what we were seeing by the third round of BCAT phase-separation samples (though recent data from BCAT-KP is fundamentally different—therefore quite exciting—but then we are back to not know what is going on—and that’s where the fun is). But ACE is a complex experiment where everything is new, and the main reason we launched so many different kinds of samples is that we didn’t know what to expect!</p>

<p>And this is where the data organization is a big challenge, basically of the chicken-and-egg type. We don’t know what images we are going to collect, so we can’t specify how it should be organized. So we get what the engineers thought would work best, basically what is logical from a collection standpoint, which almost by definition is not going to be ideal for the science. So it is an enormous task to sort everything out, and validate the data: how do I know that an image I open up on my computer is from the right sample, with the combination of parameters (lenses, camera settings, position, depth, etc.)?</p>

<p>Ultimately, there needs to be a <em>combined, close effort between the science-based PIs and engineers (in concert with operations)</em> to define the right procedures for collecting, labeling, and transmiting the right data from ISS to NASA on the ground and ultimately to us in the lab who will analyze the data. To do this, we need first to understand the challenges of the existing systems, as well as the scientific requirements, then develop a proposal for moving forward. <strong>And this cannot be done before actually acquiring and receiving significant data from ISS; there is no way to do this ahead of time!</strong></p>

<h1 id="limitations-of-the-current-data-organization">Limitations of the current data organization</h1>

<p>The current way data is collected and stored on LMM has several fundamental issues which must be resolved before the set of images collected onboard ISS becomes usable experimental data. Just as the raw voltage levels from each pixel of the camera need to be assembled into a digital image, those images must be assembled into well-organized, well-documented collections in order to be at all useful. And those images must be connected</p>

<h3 id="metadata-is-not-stored-with-the-images">Metadata is not stored with the images</h3>

<p>The <em>metadata</em> of each image, including the camera settings (exposure, gain, black-level offset), microscope settings (objective lens, filter, illumination), sample location (sample well, and x-y-z position within it) are not stored in the image itself, for example in metadata fields within a TIF image (which could easily defined to contain this). The software that writes the image to disk does not incorporate any of this information with the image itself. So there is no “self-documentation” of each image, which represents a good practice in general, especially when we have so many images. Anything else quickly becomes prone to error.</p>

<h3 id="some-information-is-stored-in-the-directory">Some information is stored in the directory</h3>

<p>Right now, which sample well and platter, which can be <a href="/2014/03/05/ace_m2_sample_layout.html">mapped 1-to-1</a>, then the objective, and the depth within the sample, are each stored in various directories / folders, within which the images for each day are sorted. There are additional levels of folders for the timing (seconds elapsed since experiment was run) and an experiment number defined by the operator.</p>

<h3 id="when-a-number-is-assigned-to-an-experiment-and-what-an-experiment-includes-varies-significantly">When a number is assigned to an experiment, and what an experiment includes, varies significantly</h3>

<p>As we are defining what data to collect, what amount corresponds to a new experiment number has varied both over time, and between operators. So data gets put into new experiments in some places in a way that is not the same as other, ostensibly identical data.</p>

<h3 id="file-names-are-basically-all-the-same">File names are basically all the same</h3>

<p>This is a significant problem when it comes to data organization. A typical filename is <code class="highlighter-rouge">00001_00000.tif</code>, and in fact remains the same for different samples, and different days. Thus, if a file is moved out of its directory, all information is lost and it cannot be checked to see where it came from.</p>

<p>Moreover, when we look at the evolution of samples over time, having the same exact filename means I cannot simply drag images from the same place, objective, depth, and settings from successive days into the folder, but have to rename each one individually, without direct access by the operator who collected the images. This makes any form of automated analysis impossible, and even manual analysis is a challenge to even keep track of what images I am looking it.</p>

<p>Of course, there was no obvious way to specify how the engineers could have added the right information ahead of time, not knowing what samples would be, how we would look at them, etc. etc. Probably the best they could have done was to generate a random alphanumeric code as part of each image’s filename, which could then be later correlated, but that would not have been much of an improvement.</p>

<p><em>Instead, what we need is a comprehensive plan to organize the data we have collected, which involves close cooperation between us on the science / PI side, the engineers who designed the hardware and wrote the software, and the operators who actually collect the data.</em> So here’s the current proposal for how to move forward, which I and Louis Chestney (who wrote the software and collected a lot of great data) came up with:</p>

<h1 id="how-we-plan-to-organize-things">How we plan to organize things</h1>

<p>Unfortunately, there is no perfect, or even optimal way, to organize the data, involving thousands of images from dozens of samples on dozens of days of operations. We have a number of constraints, conceptual and practical, that have to be addressed.</p>

<p>There is always a tension between organizing the data in a way that is best for the subsequent analysis, and one that reflects the history of how it was collected. The problem is that the history can be haphazard, in our case jumping around to take different samples at different settings. And the analysis is never defined until basically it’s done, and we don’t want to have to do this process more than once.</p>

<p>Moreover, there is a limit to the number of characters that fit comfortably within a filename before some of the computer systems that handle the files get unhappy (thank you IBM and Microsoft from the 1980s for this horrid legacy).</p>

<p>So for the most common / redundant parts of the metadata, such as well, sample number, and objective, we use folders to hold that information. This is more for convenience and making it easy to check / validate the images, as well as consult historical records. For things that change each run that are important (e.g. sample position, date), we put that in the filename, which also serves to document . And for the less-important things (camera settings), we keep that information in a separate database of sorts.</p>

<h2 id="folder-organization">Folder organization</h2>

<p>The first set of folder hierarchies correspond to what sample well we are looking at, since that is the way the raw data is actually collected (i.e. at one well at a time). So the first three levels of directory structure [with examples] are :</p>

<h3 id="1-platter-platter_2105">1. Platter [<code class="highlighter-rouge">platter_2105</code>]</h3>

<p>We have two platters (2104, 2105) in ACE-M2, and one platter with our samples (2109) in ACE-M3.</p>

<h3 id="2-strip-strip_e_618">2. Strip [<code class="highlighter-rouge">strip_E_618</code>]</h3>

<p>Each platter has three strips, so A-C (with their numbers) are contained in sample 2104, D-F are in 2105, and G is in 2109.</p>

<h3 id="3-well-well_e4_s22">3. Well [<code class="highlighter-rouge">well_E4_s22</code>]</h3>

<p>Each strip has five wells, numbered 1-5, and each well contains a sample (1-22 in ACE-M2, and probably 23-27 in ACE-M3).</p>

<p>With these levels, the directory for each well identifies its platter, strip and sample, all by number, which can be double-checked against the documentation, and gives a very quick reminder exactly what sample is being looked at. There may be path length limitations, in which case we might have to shorten these names.</p>

<p>Now, within this, there are two fundamental ways we could organize the data:</p>

<ul>
  <li>
    <p>by date, creating a new folder each day, and within that, subfolders for the different magnifications and positions.</p>
  </li>
  <li>
    <p>by objective lens, so that data from each magnification is stored closely, and then within that organize by date.</p>
  </li>
</ul>

<p>There are several advantages and disadvantages to each approach. Because we are looking at the evolution of samples over time, and we want to compare images collected under nearly-identical conditions over time, it makes most sense to group by all other parameters besides time first, and then have the images in the smallest subfolders differ only in time they were collected. This also facilitates the analysis, because the same operation applied to each image within a folder makes sense only when the images represent the same conditions and positions.</p>

<p>Therefore, within each well folder, we have several more levels of subfolder:</p>

<h3 id="4-objective-lens--magnification-10x">4. Objective lens / magnification [<code class="highlighter-rouge">10x</code>]</h3>

<p>We image each sample with several objective lenses, and each sample has a different combination used. We have ultimately standardized the <a href="/2014/06/30/ace_m2_ops.html">data collection operations</a> to take 2.5x survey images, tile the full sample at 10x, and zoom into selected areas and collect tiled images at 20x and 40x magnification. The 2.5x images do not focus on a specific depth, so those images will sit in the 2p5x folder. Everything else must be more carefully specified, by how deep into the sample the images were collected.</p>

<h3 id="5-depth-into-the-sample-from-the-coverslip-z060um">5. Depth into the sample from the coverslip [<code class="highlighter-rouge">z060um</code>]</h3>

<p>These will be the main folders that hold the data of interest. In particular, there should only be a single image from a single day (with the exception of near-identical duplication for redundancy). For the 2.5x, the image is of the whole sample chamber. For the 10x, there is a single composite of the entire well. For the 20x and 40x images, there are composites of smaller areas. Individual images that form the source of each composite can then be held in a subfolder, once for each day.</p>

<h3 id="6-date-of-data-collection-179">6. Date of data collection [<code class="highlighter-rouge">179</code>]</h3>

<p>Everything NASA does uses the 3-digit numeric day of the year, which is convenient because it’s short, sequential, and takes up on three characters.</p>

<p>Because the composites will be properly labeled, as long as the folder of the source images can be identified, these images need not have unique names (preferred but not necessary), since they will always be referenced to the uniquely-named composite images.</p>

<p>Therefore, the example path for the folder would be:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/platter_2105/strip_E_618/well_E4_s22/10x/z060um/
</code></pre></div></div>

<h2 id="naming-files">Naming files</h2>

<p>The next step is to define a file naming convention. We want to preserve as much information to identify uniquely the image in a transparent way, especially when it gets moved to a different folder (e.g. for analysis). To that end, the sample platter, strip, well, and sample should be included, in the most compact form minimizing characters but preserving the unique parts of the information (since the more complete info can be read from the directories).</p>

<ul>
  <li><code class="highlighter-rouge">p4</code> for platter 2104, <code class="highlighter-rouge">p5</code> for platter 2105, etc.</li>
  <li><code class="highlighter-rouge">a</code> for strip A, <code class="highlighter-rouge">b</code> for strip B, etc.</li>
  <li><code class="highlighter-rouge">1</code> for well 1 on that strip, <code class="highlighter-rouge">2</code> for well 2 on that strip, etc.</li>
  <li><code class="highlighter-rouge">s01</code> for sample 1, <code class="highlighter-rouge">s02</code> for sample 2, etc.; two digits cover all samples</li>
  <li><code class="highlighter-rouge">02x</code> for 2.5x magnification, <code class="highlighter-rouge">10x</code> for 10x magnification, etc.; two digit numbers</li>
  <li><code class="highlighter-rouge">z060</code> for 60 micron depth relative to cover slip, <code class="highlighter-rouge">z100</code> for 100 micron depth, etc.; three digit numbers</li>
  <li><code class="highlighter-rouge">xy1</code> for first composite xy-position, <code class="highlighter-rouge">xy2</code> for second, etc; <code class="highlighter-rouge">xyA</code> for position A of individual image within a composite, <code class="highlighter-rouge">xyB</code> for position B, defined by the maps/tables. Composites are distinguished by the number, where individual images have a letter. No composite has more than 16 unique positions, so a single character is sufficient.</li>
  <li><code class="highlighter-rouge">180</code> for 180th day of the year, etc. for other dates</li>
  <li><code class="highlighter-rouge">15520</code> for experiment number 15520, to tie back into the log books.</li>
</ul>

<p>So a complete filename and path in the example would be:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/platter_2105/strip_E_618/well_E4_s22/10x/z060um/p5e4s22_10x_z060_xy1_180_15520.tif
</code></pre></div></div>

<p>This preserves a lot of information for each sample, and correlates it back to the date it was collected and the experiment number, which contains all of the imaging and position parameters. This way, if any image gets separated from its directory structure, all of the information can be reconstructed and recovered.</p>

<h1 id="practical-implementation">Practical implementation</h1>

<p>Ultimately, we will have to set up a data store for both we as the scientific team, and ZIN as the engineers and operators, to have common access to move around and rename files appropriately. As you can imagine, this will take a significant amount of time and effort all around. This is an absolutely critical task that needs to be done before any data can be analyzed carefully. There may be some basic results which I present, but this organization is required before any full, systematic analysis can take place. And that is what we will be working on a lot going forward.</p>

</article>


      </div>
    </main>
    
    </div><footer>
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a><br />This work by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.colloids.org" property="cc:attributionName" rel="cc:attributionURL">Peter J. Lu</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
</footer>

</body>

</html>
